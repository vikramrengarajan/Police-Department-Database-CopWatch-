CREATE TABLE CITIZEN (
  SSN VARCHAR2(20) NOT NULL PRIMARY KEY,
  FIRSTNAME VARCHAR2(50) NOT NULL,
  MINIT VARCHAR2(25),
  LASTNAME VARCHAR2(50) NOT NULL,
  SEX VARCHAR2(7) NOT NULL,
  EMAIL VARCHAR2(250) NOT NULL,
  DOB DATE
);

CREATE TABLE CONTACT (
  SSN VARCHAR2(20) NOT NULL, 
  MOBILENO VARCHAR2(25) NOT NULL, 
  STREET_ADDRESS VARCHAR2(500) NOT NULL, 
  CITY VARCHAR2(50) NOT NULL, 
  COUNTRY VARCHAR2(50) NOT NULL,
  ZIPCODE VARCHAR2(20) NOT NULL,
  FOREIGN KEY(SSN) REFERENCES CITIZEN(SSN) ON DELETE CASCADE,
  PRIMARY KEY (SSN, MOBILENO)
);

CREATE TABLE DEPARTMENT (
  DEPT_ID VARCHAR2(20) NOT NULL PRIMARY KEY,
  DEPTNAME VARCHAR2(100) NOT NULL,
  NO_OF_OFFICERS INT DEFAULT 0
);

CREATE TABLE OFFICER (
  OFFICER_ID VARCHAR2(20) NOT NULL PRIMARY KEY,
  BADGENO VARCHAR2(25) NOT NULL,
  FIRSTNAME VARCHAR2(50) NOT NULL,
  MINIT VARCHAR2(25),
  LASTNAME VARCHAR2(50) NOT NULL,
  SEX VARCHAR2(7) NOT NULL,
  DESIGNATIONATION VARCHAR2(50) NOT NULL,
  DATE_JOINED DATE,
  DEPT_ID VARCHAR2(20),
  FOREIGN KEY (DEPT_ID) REFERENCES DEPARTMENT(DEPT_ID) ON DELETE SET NULL
);

CREATE TABLE DEPARTMENT_CONTROL (
  DEPT_ID VARCHAR2(20) NOT NULL, 
  CONTROLLING_OFFICER_ID VARCHAR2(20) NOT NULL,
  PRIMARY KEY (DEPT_ID, CONTROLLING_OFFICER_ID),
  FOREIGN KEY (DEPT_ID) REFERENCES DEPARTMENT(DEPT_ID) ON DELETE CASCADE,
  FOREIGN KEY (CONTROLLING_OFFICER_ID) REFERENCES OFFICER(OFFICER_ID) ON DELETE CASCADE
);

CREATE TABLE FIREARM (
  FIREARM_ID VARCHAR2(20) NOT NULL PRIMARY KEY,
  DESCRIPTION VARCHAR2(500),
  OFFICER_ID VARCHAR2(20) NOT NULL,
  FOREIGN KEY(OFFICER_ID) REFERENCES OFFICER(OFFICER_ID) ON DELETE CASCADE
);

CREATE TABLE SHIFT (
  SHIFT_ID VARCHAR2(20) NOT NULL PRIMARY KEY,
  SHIFT_NAME VARCHAR2(100) NOT NULL,
  DESCRIPTION VARCHAR2(500),
  START_TIME DATE,
  END_TIME DATE,
  DAYS_OF_WEEK VARCHAR2(20)
);

CREATE TABLE OFFICER_SHIFT(
  OFFICER_ID VARCHAR2(20) NOT NULL,
  SHIFT_ID VARCHAR2(20) NOT NULL,
  PRIMARY KEY (OFFICER_ID, SHIFT_ID),
  FOREIGN KEY (OFFICER_ID) REFERENCES OFFICER(OFFICER_ID) ON DELETE CASCADE,
  FOREIGN KEY (SHIFT_ID) REFERENCES SHIFT(SHIFT_ID) ON DELETE CASCADE
);

CREATE TABLE INCIDENT_TYPE (
  TYPE_ID VARCHAR2(20) NOT NULL PRIMARY KEY,
  DESCRIPTION VARCHAR2(500) NOT NULL
);

CREATE TABLE INCIDENT_STATUS (
  STATUS_ID VARCHAR(20) NOT NULL PRIMARY KEY,
  DESCRIPTION VARCHAR2(500) NOT NULL
);

CREATE TABLE INCIDENT (
  INCIDENT_ID VARCHAR2(20) NOT NULL PRIMARY KEY,
  DESCRIPTION VARCHAR2(500) NOT NULL,
  TYPE_ID VARCHAR2(20),
  OFFICER_ID VARCHAR2(20),
  STATUS_ID VARCHAR2(20),
  START_DATE DATE,
  END_DATE DATE,
  FOREIGN KEY (OFFICER_ID) REFERENCES OFFICER(OFFICER_ID) ON DELETE SET NULL,
  FOREIGN KEY (TYPE_ID) REFERENCES INCIDENT_TYPE(TYPE_ID) ON DELETE SET NULL,
  FOREIGN KEY (STATUS_ID) REFERENCES INCIDENT_STATUS(STATUS_ID) ON DELETE SET NULL
);

CREATE TABLE REPORT (
  REPORT_ID VARCHAR2(20) NOT NULL PRIMARY KEY,
  DESCRIPTION VARCHAR(500) NOT NULL,
  INCIDENT_ID VARCHAR2(20) NOT NULL,
  OFFICER_ID VARCHAR2(10),
  FOREIGN KEY (INCIDENT_ID) REFERENCES INCIDENT(INCIDENT_ID) ON DELETE CASCADE,
  FOREIGN KEY (OFFICER_ID) REFERENCES OFFICER(OFFICER_ID) ON DELETE SET NULL
);

CREATE TABLE ROLE (
  ROLE_CODE VARCHAR2(20) NOT NULL PRIMARY KEY,
  ROLE_NAME VARCHAR2(50) NOT NULL,
  DESCRIPTION VARCHAR2(500)
);

CREATE TABLE INVOLVED_IN (
  ROLE_CODE VARCHAR2(20),
  SSN VARCHAR2(20) NOT NULL,
  INCIDENT_ID VARCHAR2(20) NOT NULL,
  PRIMARY KEY(ROLE_CODE, SSN, INCIDENT_ID),
  FOREIGN KEY (ROLE_CODE) REFERENCES ROLE(ROLE_CODE) ON DELETE SET NULL,
  FOREIGN KEY (SSN) REFERENCES CITIZEN(SSN) ON DELETE CASCADE,
  FOREIGN KEY (INCIDENT_ID) REFERENCES INCIDENT(INCIDENT_ID) ON DELETE CASCADE
);

ALTER TABLE CITIZEN ADD CONSTRAINT uk_citizen UNIQUE(EMAIL);
ALTER TABLE CONTACT ADD CONSTRAINT uk_contact UNIQUE (MOBILENO);
ALTER TABLE OFFICER ADD CONSTRAINT uk_officer UNIQUE (OFFICER_ID, BADGENO);

INSERT INTO CITIZEN VALUES('999-000-3939', 'Walter', 'H', 'White', 'Male', 'walter.white@gmail.com', TO_DATE('1963/05/03', 'yyyy/mm/dd'));
INSERT INTO CITIZEN VALUES('999-012-3934', 'Dexter', 'J', 'Morgan', 'Male', 'dexter.morgan@gmail.com', TO_DATE('1978/08/01', 'yyyy/mm/dd'));
INSERT INTO CITIZEN VALUES('434-200-2956', 'Skyler', 'H', 'White', 'Female', 'skyler.white@gmail.com', TO_DATE('1968/01/12', 'yyyy/mm/dd'));
INSERT INTO CITIZEN VALUES('903-120-3339', 'Debra', 'J', 'Morgan', 'Female', 'debra.morgan@gmail.com', TO_DATE('1983/02/03', 'yyyy/mm/dd'));
INSERT INTO CITIZEN VALUES('800-230-8393', 'Elena', 'M', 'Gilbert', 'Female', 'elena.gitbert@gmail.com', TO_DATE('1987/01/12', 'yyyy/mm/dd'));

INSERT INTO CONTACT VALUES('999-012-3934', '987-389-3121', '469 Coit Avenue', 'Miami', 'United States', '84773');
INSERT INTO CONTACT VALUES('903-120-3339', '987-389-3122', '849 Florida Avenue', 'Miami', 'United States', '84774');
INSERT INTO CONTACT VALUES('999-000-3939', '409-210-3345', '4234 McCallum Blvd, Albuquerque', 'New Mexico', 'United States', '67483');
INSERT INTO CONTACT VALUES('434-200-2956', '409-210-3433', '4234 McCallum Blvd, Albuquerque', 'New Mexico', 'United States', '67483');
INSERT INTO CONTACT VALUES('800-230-8393', '887-903-1230', '3929 Preston Avenue', 'New York', 'United States', '59392');

INSERT INTO DEPARTMENT VALUES('DP1000', 'Homicide', 100);
INSERT INTO DEPARTMENT VALUES('DP1001', 'Law Enforcement', 421);
INSERT INTO DEPARTMENT VALUES('DP1002', 'Crime Division', 3294);
INSERT INTO DEPARTMENT VALUES('DP1003', 'Drug Enforcement', 323);
INSERT INTO DEPARTMENT VALUES('DP1004', 'Public Safety', 3223);

INSERT INTO OFFICER VALUES('OF8900', 'BDG2112', 'Hank', '', 'Schrader', 'Male', 'Supervisor', TO_DATE('12/05/2009', 'dd/mm/yyyy'), 'DP1003');
INSERT INTO OFFICER VALUES('OF8790', 'BDG4276', 'Steve', 'J', 'Gomez', 'Male', 'Agent', TO_DATE('12/05/2010', 'dd/mm/yyyy'), 'DP1003');
INSERT INTO OFFICER VALUES('OF0921', 'BDG5656', 'James', '', 'Doakes', 'Male', 'Detective Seargent', TO_DATE('21/03/2005', 'dd/mm/yyyy'), 'DP1000');
INSERT INTO OFFICER VALUES('OF4222', 'BDG5532', 'Vince', 'H', 'Gillian', 'Male', 'Officer', TO_DATE('12/02/2012', 'dd/mm/yyyy'), 'DP1004');
INSERT INTO OFFICER VALUES('OF9382', 'BDG0192', 'Angel', '', 'Batista', 'Male', 'Supervisor', TO_DATE('30/01/2007', 'dd/mm/yyyy'), 'DP1002');

INSERT INTO OFFICER VALUES('OF8212', 'BDG3231', 'Maria', '', 'LaGuerta', 'Female', 'Lieutenant', TO_DATE('12/01/2001', 'dd/mm/yyyy'), 'DP1000');
INSERT INTO OFFICER VALUES('OF8214', 'BDG3423', 'Thomoas', 'J', 'Matthews', 'Male', 'Department Head', TO_DATE('12/05/1992', 'dd/mm/yyyy'), 'DP1001');
INSERT INTO OFFICER VALUES('OF1092', 'BDG1121', 'Harry', 'J', 'Morgan', 'Male', 'Seargent', TO_DATE('11/01/1999', 'dd/mm/yyyy'), 'DP1002');
INSERT INTO OFFICER VALUES('OF1322', 'BDG3320', 'Joseph', '', 'Quinn', 'Male', 'Seargent', TO_DATE('11/01/2010', 'dd/mm/yyyy'), 'DP1004');

INSERT INTO DEPARTMENT_CONTROL VALUES('DP1000', 'OF8212');
INSERT INTO DEPARTMENT_CONTROL VALUES('DP1001', 'OF8214');
INSERT INTO DEPARTMENT_CONTROL VALUES('DP1002', 'OF1092');
INSERT INTO DEPARTMENT_CONTROL VALUES('DP1003', 'OF8900');
INSERT INTO DEPARTMENT_CONTROL VALUES('DP1004', 'OF1322');

INSERT INTO FIREARM VALUES('FA1000', 'Pistol', 'OF8790');
INSERT INTO FIREARM VALUES('FA1001', 'Hand Gun', 'OF8900');
INSERT INTO FIREARM VALUES('FA1002', 'Pistol', 'OF8212');
INSERT INTO FIREARM VALUES('FA1003', 'Beretta', 'OF4222');
INSERT INTO FIREARM VALUES('FA1004', 'Pistol', 'OF8214');

INSERT INTO SHIFT VALUES('SH1000', 'Morning', 'Morning Shift', TO_DATE('09:00:00 AM', 'hh:mi:ss pm'), TO_DATE('05:00:00 PM', 'hh:mi:ss pm'), 'M-T-W-TH-F');
INSERT INTO SHIFT VALUES('SH1001', 'Night', 'Night Shift', TO_DATE('09:00:00 PM', 'hh:mi:ss pm'), TO_DATE('05:00:00 AM', 'hh:mi:ss pm'), 'M-T-W-TH-F');
INSERT INTO SHIFT VALUES('SH1002', 'Evening', 'Evening Shift', TO_DATE('05:00:00 PM', 'hh:mi:ss pm'), TO_DATE('03:00:00 AM', 'hh:mi:ss pm'), 'M-T-W-TH-F');
INSERT INTO SHIFT VALUES('SH1003', 'Noon', 'Noon Shift', TO_DATE('11:00:00 AM', 'hh:mi:ss pm'), TO_DATE('08:00:00 PM', 'hh:mi:ss pm'), 'M-T-W-TH-F');
INSERT INTO SHIFT VALUES('SH1004', 'Part', 'Part-time Shift', TO_DATE('09:00:00 AM', 'hh:mi:ss pm'), TO_DATE('05:00:00 PM', 'hh:mi:ss pm'), 'SA-SU');

INSERT INTO OFFICER_SHIFT VALUES('OF8900', 'SH1000');
INSERT INTO OFFICER_SHIFT VALUES('OF8212', 'SH1000');
INSERT INTO OFFICER_SHIFT VALUES('OF8790', 'SH1003');
INSERT INTO OFFICER_SHIFT VALUES('OF8214', 'SH1004');
INSERT INTO OFFICER_SHIFT VALUES('OF1092', 'SH1001');

INSERT INTO INCIDENT_TYPE VALUES('TY1000', 'Murder');
INSERT INTO INCIDENT_TYPE VALUES('TY1001', 'Theft');
INSERT INTO INCIDENT_TYPE VALUES('TY1002', 'Accident');
INSERT INTO INCIDENT_TYPE VALUES('TY1003', 'Drug abuse');
INSERT INTO INCIDENT_TYPE VALUES('TY1004', 'Kidnap');

INSERT INTO INCIDENT_STATUS VALUES('ST1000', 'Open');
INSERT INTO INCIDENT_STATUS VALUES('ST1001', 'Closed');
INSERT INTO INCIDENT_STATUS VALUES('ST1002', 'In Progress');
INSERT INTO INCIDENT_STATUS VALUES('ST1003', 'Unknown');
INSERT INTO INCIDENT_STATUS VALUES('ST1004', 'New');

INSERT INTO INCIDENT VALUES('INC100', 'Robbery at Walker St.', 'TY1001', 'OF9382', 'ST1000', TO_DATE('09/09/2014', 'dd/mm/yyyy'), NULL);
INSERT INTO INCIDENT VALUES('INC101', 'Murder', 'TY1000', 'OF0921', 'ST1001', TO_DATE('01/04/2014', 'dd/mm/yyyy'), NULL);
INSERT INTO INCIDENT VALUES('INC102', 'Accident at Coit Rd.', 'TY1004', 'OF4222', 'ST1000', TO_DATE('10/04/2015', 'dd/mm/yyyy'), NULL);
INSERT INTO INCIDENT VALUES('INC103', 'Murder', 'TY1000', 'OF0921', 'ST1000', TO_DATE('05/04/2014', 'dd/mm/yyyy'), NULL);
INSERT INTO INCIDENT VALUES('INC104', 'Drug Abuse', 'TY1004', 'OF8900', 'ST1000', TO_DATE('12/12/2014', 'dd/mm/yyyy'), NULL);

INSERT INTO REPORT VALUES('REP1000', 'Robery at Walker St. on 09/09/2014 at 09.00pm. 2 Victims. Suspect under Interogation', 'INC100', 'OF9382');
INSERT INTO REPORT VALUES('REP1001', 'Murder on 04/01/2014 at 03.00am. Murderer found. Case closed.', 'INC101', 'OF0921');
INSERT INTO REPORT VALUES('REP1002', 'Accident at Coid Rd. Hit and Run', 'INC102', 'OF4222');
INSERT INTO REPORT VALUES('REP1003', 'Another Murder in the same week. Weird. Suspects under Interogation', 'INC103', 'OF0921');
INSERT INTO REPORT VALUES('REP1004', 'Drug case caught in the Suburbs. Illegal Drug Abuse.', 'INC104', 'OF8900');

INSERT INTO ROLE VALUES('ROLE001', 'Victim', 'Victim of the Crime');
INSERT INTO ROLE VALUES('ROLE002', 'Witness', 'Witnesses of the Crime');
INSERT INTO ROLE VALUES('ROLE003', 'Suspect', 'Suspect in the Crime');
INSERT INTO ROLE VALUES('ROLE004', 'Culprit', 'Person Accused for the Crime');

INSERT INTO INVOLVED_IN VALUES('ROLE001', '800-230-8393', 'INC101');
INSERT INTO INVOLVED_IN VALUES('ROLE004', '999-012-3934', 'INC101');
INSERT INTO INVOLVED_IN VALUES('ROLE002', '903-120-3339', 'INC101');
INSERT INTO INVOLVED_IN VALUES('ROLE003', '999-000-3939', 'INC103');
INSERT INTO INVOLVED_IN VALUES('ROLE001', '434-200-2956', 'INC103');

SELECT * FROM INCIDENT WHERE INCIDENT_ID = (SELECT INCIDENT_ID FROM INVOLVED_IN WHERE SSN='800-230-8393' AND ROLE_CODE='ROLE001');
SELECT * FROM CITIZEN A INNER JOIN CONTACT B ON A.SSN = B.SSN WHERE A.SSN IN (SELECT SSN FROM INVOLVED_IN WHERE INCIDENT_ID='INC101' AND ROLE_CODE='ROLE001');
SELECT B.DEPTNAME, COUNT(*) FROM OFFICER A INNER JOIN DEPARTMENT B ON A.DEPT_ID = B.DEPT_ID GROUP BY B.DEPTNAME;
SELECT * FROM OFFICER WHERE OFFICER_ID = (SELECT OFFICER_ID FROM INCIDENT WHERE INCIDENT_ID = 
(SELECT INCIDENT_ID FROM INVOLVED_IN WHERE SSN='800-230-8393' AND ROLE_CODE='ROLE001'));

ALTER TABLE REPORT ADD(CREATED_AT DATE);
ALTER TABLE REPORT DROP(CREATED_AT);

UPDATE DEPARTMENT SET NO_OF_OFFICERS=1000 WHERE DEPT_ID='DP1000';
SELECT FIRSTNAME, MINIT, LASTNAME, SEX FROM CITIZEN UNION SELECT FIRSTNAME, MINIT, LASTNAME, SEX FROM OFFICER ORDER BY FIRSTNAME;

DELETE FROM OFFICER WHERE OFFICER_ID='OF8214';
DELETE FROM REPORT;

DROP TABLE REPORT;
